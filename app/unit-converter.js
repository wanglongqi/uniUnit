const unitConversions = {
    length: {
        meter: 1,
        kilometer: 1000,
        centimeter: 0.01,
        millimeter: 0.001,
        micrometer: 1e-6,
        nanometer: 1e-9,
        picometer: 1e-12,
        femtometer: 1e-15,
        kilometer: 1000,
        decimeter: 0.1,
        inch: 0.0254,
        foot: 0.3048,
        yard: 0.9144,
        mile: 1609.344,
        nautical_mile: 1852,
        light_year: 9.461e15,
        astronomical_unit: 1.496e11,
        parsec: 3.086e16,
        mil: 0.0000254,
        micron: 1e-6,
        angstrom: 1e-10,
        au: 1.496e11,
        ly: 9.461e15,
        pc: 3.086e16,
        m: 1,
        km: 1000,
        cm: 0.01,
        mm: 0.001,
        um: 1e-6,
        nm: 1e-9,
        pm: 1e-12,
        fm: 1e-15,
        dm: 0.1,
        in: 0.0254,
        ft: 0.3048,
        yd: 0.9144,
        mi: 1609.344,
        nmi: 1852,
        Ã…: 1e-10,
    },
    mass: {
        kilogram: 1,
        gram: 0.001,
        milligram: 1e-6,
        microgram: 1e-9,
        metric_ton: 1000,
        pound: 0.453592,
        ounce: 0.0283495,
        stone: 6.35029,
        short_ton: 907.185,
        long_ton: 1016.05,
        carat: 0.0002,
        atomic_mass_unit: 1.66054e-27,
        kg: 1,
        g: 0.001,
        mg: 1e-6,
        ug: 1e-9,
        lb: 0.453592,
        oz: 0.0283495,
        st: 6.35029,
        amu: 1.66054e-27,
        u: 1.66054e-27,
    },
    time: {
        second: 1,
        millisecond: 0.001,
        microsecond: 1e-6,
        nanosecond: 1e-9,
        picosecond: 1e-12,
        minute: 60,
        hour: 3600,
        day: 86400,
        week: 604800,
        month: 2629746,
        year: 31556952,
        s: 1,
        ms: 0.001,
        us: 1e-6,
        ns: 1e-9,
        ps: 1e-12,
        min: 60,
        h: 3600,
        d: 86400,
        wk: 604800,
        yr: 31556952,
    },
    temperature: {
        kelvin: { toBase: 1, fromBase: 1, offset: 0 },
        celsius: { toBase: 1, fromBase: 1, offset: 273.15 },
        fahrenheit: { toBase: 5/9, fromBase: 9/5, offset: 255.372 },
        rankine: { toBase: 5/9, fromBase: 9/5, offset: 0 },
        K: { toBase: 1, fromBase: 1, offset: 0 },
        degC: { toBase: 1, fromBase: 1, offset: 273.15 },
        degF: { toBase: 5/9, fromBase: 9/5, offset: 255.372 },
        R: { toBase: 5/9, fromBase: 9/5, offset: 0 },
    },
    area: {
        square_meter: 1,
        square_kilometer: 1e6,
        square_centimeter: 1e-4,
        square_millimeter: 1e-6,
        hectare: 10000,
        acre: 4046.86,
        square_foot: 0.092903,
        square_inch: 0.00064516,
        square_yard: 0.836127,
        square_mile: 2589988.11,
        m2: 1,
        km2: 1e6,
        cm2: 1e-4,
        mm2: 1e-6,
        ha: 10000,
        ac: 4046.86,
        ft2: 0.092903,
        in2: 0.00064516,
        yd2: 0.836127,
        mi2: 2589988.11,
    },
    volume: {
        cubic_meter: 1,
        liter: 0.001,
        milliliter: 1e-6,
        cubic_centimeter: 1e-6,
        cubic_millimeter: 1e-9,
        gallon_us: 0.00378541,
        gallon_uk: 0.00454609,
        quart_us: 0.000946353,
        pint_us: 0.000473176,
        cup_us: 0.000236588,
        fluid_ounce_us: 2.9574e-5,
        cubic_foot: 0.0283168,
        cubic_inch: 1.6387e-5,
        m3: 1,
        L: 0.001,
        mL: 1e-6,
        cm3: 1e-6,
        mm3: 1e-9,
        gal: 0.00378541,
        gal_uk: 0.00454609,
        qt: 0.000946353,
        pt: 0.000473176,
        cup: 0.000236588,
        fl_oz: 2.9574e-5,
        ft3: 0.0283168,
        in3: 1.6387e-5,
    },
    speed: {
        meter_per_second: 1,
        kilometer_per_hour: 0.277778,
        mile_per_hour: 0.44704,
        foot_per_second: 0.3048,
        knot: 0.514444,
        mach: 343,
        speed_of_light: 299792458,
        m_s: 1,
        km_h: 0.277778,
        mph: 0.44704,
        ft_s: 0.3048,
        kn: 0.514444,
        c: 299792458,
    },
    force: {
        newton: 1,
        kilonewton: 1000,
        meganewton: 1e6,
        dyne: 1e-5,
        pound_force: 4.44822,
        kilogram_force: 9.80665,
        poundal: 0.138255,
        N: 1,
        kN: 1000,
        MN: 1e6,
        dyn: 1e-5,
        lbf: 4.44822,
        kgf: 9.80665,
        pdl: 0.138255,
    },
    pressure: {
        pascal: 1,
        kilopascal: 1000,
        megapascal: 1e6,
        bar: 1e5,
        millibar: 100,
        atmosphere: 101325,
        torr: 133.322,
        psi: 6894.76,
        mmHg: 133.322,
        Pa: 1,
        kPa: 1000,
        MPa: 1e6,
        bar: 1e5,
        mbar: 100,
        atm: 101325,
        Torr: 133.322,
        psi: 6894.76,
    },
    energy: {
        joule: 1,
        kilojoule: 1000,
        megajoule: 1e6,
        calorie: 4.184,
        kilocalorie: 4184,
        watt_hour: 3600,
        kilowatt_hour: 3.6e6,
        electronvolt: 1.6022e-19,
        british_thermal_unit: 1055.06,
        foot_pound: 1.35582,
        erg: 1e-7,
        J: 1,
        kJ: 1000,
        MJ: 1e6,
        cal: 4.184,
        kcal: 4184,
        Wh: 3600,
        kWh: 3.6e6,
        eV: 1.6022e-19,
        BTU: 1055.06,
        ft_lb: 1.35582,
        erg: 1e-7,
    },
    power: {
        watt: 1,
        kilowatt: 1000,
        megawatt: 1e6,
        gigawatt: 1e9,
        horsepower: 745.7,
        metric_horsepower: 735.499,
        BTU_per_hour: 0.293071,
        foot_pound_per_second: 1.35582,
        W: 1,
        kW: 1000,
        MW: 1e6,
        GW: 1e9,
        hp: 745.7,
        PS: 735.499,
    },
    electric: {
        volt: 1,
        millivolt: 0.001,
        microvolt: 1e-6,
        kilovolt: 1000,
        megavolt: 1e6,
        ampere: 1,
        milliampere: 0.001,
        microampere: 1e-6,
        nanoampere: 1e-9,
        ohm: 1,
        milliohm: 0.001,
        V: 1,
        mV: 0.001,
        uV: 1e-6,
        kV: 1000,
        MV: 1e6,
        A: 1,
        mA: 0.001,
        uA: 1e-6,
        nA: 1e-9,
        ohm: 1,
        mohm: 0.001,
    },
};

function getUnitCategory(unit) {
    unit = unit.toLowerCase().replace(/[^a-z0-9]/g, '');
    for (const [category, units] of Object.entries(unitConversions)) {
        if (unit in units || unit.replace('_per_', '/').replace('per', '/') in units) {
            return category;
        }
    }
    return null;
}

function normalizeUnit(unit) {
    unit = unit.toLowerCase().trim();
    const replacements = {
        ' ': '',
        'meter': 'meter',
        'metre': 'meter',
        'kilometre': 'kilometer',
        'centimetre': 'centimeter',
        'millimetre': 'millimeter',
        'micrometre': 'micrometer',
        'nanometre': 'nanometer',
        'picometre': 'picometer',
        'femtometre': 'femtometer',
        'dekameter': 'dekameter',
        'decimetre': 'decimeter',
        'gram': 'gram',
        'kilogram': 'kilogram',
        'milligram': 'milligram',
        'microgram': 'microgram',
        'second': 'second',
        'minute': 'minute',
        'hour': 'hour',
        'day': 'day',
        'week': 'week',
        'month': 'month',
        'year': 'year',
        'kelvin': 'kelvin',
        'celsius': 'celsius',
        'fahrenheit': 'fahrenheit',
        'rankine': 'rankine',
        'fahrenheit': 'fahrenheit',
        'degc': 'degC',
        'degf': 'degF',
        'degk': 'kelvin',
        'degree_celsius': 'degC',
        'degree_fahrenheit': 'degF',
        'degree_kelvin': 'kelvin',
        'lbs': 'lb',
        'lbs': 'lb',
        'oz': 'oz',
        'inches': 'in',
        'inches': 'in',
        'feet': 'ft',
        'yards': 'yd',
        'miles': 'mi',
        'knots': 'kn',
        'knots': 'kn',
        'mph': 'mph',
        'kph': 'km_h',
        'kmh': 'km_h',
        'mps': 'm_s',
        'rps': 'rps',
        'rpm': 'rpm',
    };
    for (const [key, value] of Object.entries(replacements)) {
        if (unit === key) return value;
    }
    return unit;
}

function convert(value, fromUnit, toUnit) {
    fromUnit = normalizeUnit(fromUnit);
    toUnit = normalizeUnit(toUnit);
    
    const category = getUnitCategory(fromUnit);
    if (!category) {
        throw new Error(`Unknown unit: ${fromUnit}`);
    }
    
    const units = unitConversions[category];
    
    if (!(fromUnit in units) || !(toUnit in units)) {
        throw new Error(`Unit not found in ${category}: ${fromUnit} or ${toUnit}`);
    }
    
    const fromData = units[fromUnit];
    const toData = units[toUnit];
    
    if (category === 'temperature') {
        const kelvin = (value - fromData.offset) / fromData.toBase;
        const result = kelvin * toData.fromBase + toData.offset;
        return result;
    }
    
    const baseValue = value * fromData;
    const result = baseValue / toData;
    return result;
}

function isTemperatureUnit(unit) {
    const tempUnits = ['kelvin', 'celsius', 'fahrenheit', 'rankine', 'k', 'degc', 'degf', 'r', 'degc', 'degf'];
    return tempUnits.includes(normalizeUnit(unit));
}

window.jsUnitConverter = {
    convert,
    isTemperatureUnit,
    getUnitCategory,
    normalizeUnit,
};
